<Window x:Class="DiskAnalyzer.Views.QuickCleanDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Quick Clean - Select Items" 
        Height="550" Width="700"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource BackgroundBrush}"
        ResizeMode="CanResize"
        MinHeight="400" MinWidth="500">
    
    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,12">
            <TextBlock Text="ðŸ§¹ Select Items to Clean" 
                       FontSize="18" FontWeight="SemiBold"
                       Foreground="{DynamicResource TextPrimaryBrush}"/>
            <TextBlock Text="Check the items you want to remove. Expand categories to select individual files."
                       Foreground="{DynamicResource TextSecondaryBrush}" Margin="0,4,0,0"/>
        </StackPanel>
        
        <!-- Select All / None Buttons -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,8">
            <Button Content="âœ“ Select All" Click="SelectAll_Click" 
                    Padding="12,6" Margin="0,0,8,0"
                    Background="{DynamicResource SurfaceBrush}"
                    Foreground="{DynamicResource TextPrimaryBrush}"
                    BorderBrush="{DynamicResource BorderBrush}"
                    BorderThickness="1"/>
            <Button Content="âœ— Select None" Click="SelectNone_Click" 
                    Padding="12,6"
                    Background="{DynamicResource SurfaceBrush}"
                    Foreground="{DynamicResource TextPrimaryBrush}"
                    BorderBrush="{DynamicResource BorderBrush}"
                    BorderThickness="1"/>
            <Button Content="âŠ• Expand All" Click="ExpandAll_Click" 
                    Padding="12,6" Margin="16,0,8,0"
                    Background="{DynamicResource SurfaceBrush}"
                    Foreground="{DynamicResource TextPrimaryBrush}"
                    BorderBrush="{DynamicResource BorderBrush}"
                    BorderThickness="1"/>
            <Button Content="âŠ– Collapse All" Click="CollapseAll_Click" 
                    Padding="12,6"
                    Background="{DynamicResource SurfaceBrush}"
                    Foreground="{DynamicResource TextPrimaryBrush}"
                    BorderBrush="{DynamicResource BorderBrush}"
                    BorderThickness="1"/>
        </StackPanel>
        
        <!-- Items TreeView -->
        <Border Grid.Row="2" BorderBrush="{DynamicResource BorderBrush}" 
                BorderThickness="1" CornerRadius="4" Background="{DynamicResource SurfaceBrush}">
            <TreeView x:Name="ItemsTree" ItemsSource="{Binding Items}"
                      Background="Transparent" BorderThickness="0"
                      VirtualizingStackPanel.IsVirtualizing="True">
                <TreeView.Resources>
                    <!-- Category item style -->
                    <Style TargetType="TreeViewItem">
                        <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}"/>
                        <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                        <Setter Property="Padding" Value="4"/>
                    </Style>
                </TreeView.Resources>
                <TreeView.ItemTemplate>
                    <HierarchicalDataTemplate ItemsSource="{Binding Files}">
                        <!-- Category Header -->
                        <Grid Margin="0,4">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <CheckBox Grid.Column="0" IsChecked="{Binding IsSelected}" 
                                      VerticalAlignment="Center" Margin="0,0,8,0"
                                      Click="CategoryCheckbox_Click"/>
                            
                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                <TextBlock Text="{Binding Description}" 
                                           Foreground="{DynamicResource TextPrimaryBrush}"
                                           FontWeight="SemiBold" FontSize="13"/>
                                <TextBlock Text="{Binding Path}" 
                                           Foreground="{DynamicResource TextMutedBrush}"
                                           FontSize="11" TextTrimming="CharacterEllipsis"
                                           MaxWidth="350"/>
                            </StackPanel>
                            
                            <TextBlock Grid.Column="2" Text="{Binding FileCountText}" 
                                       Foreground="{DynamicResource TextMutedBrush}"
                                       VerticalAlignment="Center" Margin="12,0"
                                       FontSize="11"/>
                            
                            <TextBlock Grid.Column="3" Text="{Binding SavingsFormatted}" 
                                       Foreground="{DynamicResource TextSecondaryBrush}"
                                       VerticalAlignment="Center" Margin="8,0"
                                       FontWeight="Medium"/>
                            
                            <TextBlock Grid.Column="4" Text="{Binding RiskLevel}" 
                                       VerticalAlignment="Center" Width="40"
                                       FontWeight="Medium" FontSize="11">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding RiskLevel}" Value="Safe">
                                                <Setter Property="Foreground" Value="#10B981"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding RiskLevel}" Value="Low">
                                                <Setter Property="Foreground" Value="#3B82F6"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </Grid>
                        
                        <!-- Individual File Template -->
                        <HierarchicalDataTemplate.ItemTemplate>
                            <DataTemplate>
                                <Grid Margin="20,2,0,2">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <CheckBox Grid.Column="0" IsChecked="{Binding IsSelected}" 
                                              VerticalAlignment="Center" Margin="0,0,8,0"
                                              Click="FileCheckbox_Click"/>
                                    
                                    <TextBlock Grid.Column="1" Text="{Binding DisplayName}" 
                                               Foreground="{DynamicResource TextSecondaryBrush}"
                                               VerticalAlignment="Center"
                                               TextTrimming="CharacterEllipsis"
                                               ToolTip="{Binding FullPath}"/>
                                    
                                    <TextBlock Grid.Column="2" Text="{Binding SizeFormatted}" 
                                               Foreground="{DynamicResource TextMutedBrush}"
                                               VerticalAlignment="Center" Margin="12,0,0,0"
                                               FontSize="11"/>
                                </Grid>
                            </DataTemplate>
                        </HierarchicalDataTemplate.ItemTemplate>
                    </HierarchicalDataTemplate>
                </TreeView.ItemTemplate>
            </TreeView>
        </Border>
        
        <!-- Summary -->
        <Border Grid.Row="3" Background="{DynamicResource BackgroundBrush}" 
                BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1"
                CornerRadius="4" Padding="12" Margin="0,12,0,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <TextBlock Text="Selected: " Foreground="{DynamicResource TextSecondaryBrush}"/>
                    <TextBlock x:Name="SelectedCountText" Text="0 categories" 
                               Foreground="{DynamicResource TextPrimaryBrush}" FontWeight="Medium"/>
                    <TextBlock Text=" â€¢ Space to recover: " Foreground="{DynamicResource TextSecondaryBrush}" Margin="16,0,0,0"/>
                    <TextBlock x:Name="SelectedSizeText" Text="0 B" 
                               Foreground="#10B981" FontWeight="Bold" FontSize="14"/>
                </StackPanel>
                
                <TextBlock Grid.Column="1" x:Name="SelectedFilesText" Text="0 files"
                           Foreground="{DynamicResource TextMutedBrush}" FontSize="11"/>
            </Grid>
        </Border>
        
        <!-- Buttons -->
        <StackPanel Grid.Row="4" Orientation="Horizontal" 
                    HorizontalAlignment="Right" Margin="0,12,0,0">
            <Button Content="Cancel" Click="Cancel_Click" 
                    Padding="20,10" Margin="0,0,8,0"
                    Background="{DynamicResource SurfaceBrush}"
                    Foreground="{DynamicResource TextPrimaryBrush}"
                    BorderBrush="{DynamicResource BorderBrush}"
                    BorderThickness="1"/>
            <Button x:Name="CleanButton" Content="ðŸ§¹ Clean Selected" Click="Clean_Click" 
                    Padding="20,10"
                    Background="#4CAF50"
                    Foreground="White"
                    BorderThickness="0"
                    FontWeight="SemiBold"/>
        </StackPanel>
    </Grid>
</Window>
